System.register("chunks:///_virtual/ArrowState.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"44b7eXodERMMYuibZgrxHlM","ArrowState",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/Boss.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TweenPool.ts","./gameConfig.ts"],(function(t){var e,s,o,n,i,r,a,c,h,u;return{setters:[function(t){e=t.inheritsLoose},function(t){s=t.cclegacy,o=t._decorator,n=t.Sprite,i=t.Collider2D,r=t.Vec3,a=t.tween,c=t.Component},function(t){h=t.TweenPool},function(t){u=t.gameConfig}],execute:function(){var d;s._RF.push({},"e338bO3cihNFKjLHJ0Bl1G6","Boss",void 0);var l=o.ccclass;o.property,t("Boss",l("Boss")(d=function(t){function s(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).collider=void 0,e.sprite=void 0,e._onBossRemoveCB=void 0,e._target=void 0,e.id=void 0,e.state=void 0,e.now=0,e._startPos=new r,e._endPos=new r,e._tweens=new h,e._targetPos=new r,e}e(s,t);var o=s.prototype;return o.getId=function(){return this.id},o.setTargetPos=function(t){this._targetPos.set(t)},o.onLoad=function(){this.sprite=this.node.getComponent(n),this.collider=this.node.getComponent(i)},o.onEnable=function(){},o.start=function(){},o.init=function(t,e){this._tweens.clear(),this.id=t.id,this.state=t,this._startPos.set(t.pos.x,t.pos.y),this.node.position=this._startPos},o.onBossRemoveCB=function(t,e){this._onBossRemoveCB=t,this._target=e},o.updateState=function(t,e){this.state=t,this.now=e,this._tweenState()},o._tweenState=function(){if(this._targetPos.x!==this.state.pos.x||this._targetPos.y!==this.state.pos.y){this._tweens.clear();var t=new r(this.state.pos.x,this.state.pos.y);this._targetPos.set(t),this._tweens.add(a(this.node).to(1/u.syncRate,{position:this._targetPos}).call((function(){})).start())}},s}(c))||d);s._RF.pop()}}}));

System.register("chunks:///_virtual/BossState.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"4fe41Fuk41No5HnyjpinC68","BossState",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/Enemies.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyBullet.ts","./HpBarSystem.ts"],(function(e){var t,n,s,l,o,i,a,r,u,c,B,f,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,s=e.initializerDefineProperty,l=e.assertThisInitialized,o=e.createClass},function(e){i=e.cclegacy,a=e._decorator,r=e.resources,u=e.Prefab,c=e.instantiate,B=e.Component},function(e){f=e.EnemyBullet},function(e){p=e.HpBarSystem}],execute:function(){var b,h,d,m,v;i._RF.push({},"8cd7fV3l1BPpKY6c1MYGvtA","Enemies",void 0);var y=a.ccclass,g=a.property;e("Enemies",(b=y("Enemies"),h=g(p),b((v=t((m=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,s(t,"hpBarSystem",v,l(t)),t._bulletInstances={},t.bossBulletPrefab=void 0,t.isLoadingBossBullet=!1,t}n(t,e);var i=t.prototype;return i.start=function(){},i.onLoad=function(){},i.onEnable=function(){},i.onDisable=function(){},i.updateBossHp=function(e,t){this.hpBarSystem.updateHealth(e,t)},i.addOneBullet=function(e){var t,n=this;this._bulletInstances[e.id]||(this.bossBulletPrefab?(t=c(this.bossBulletPrefab),this.createBossBulletInstances(t,e)):0==this.isLoadingBossBullet&&(this.isLoadingBossBullet=!0,r.load("prefabs/EnemyBullet",u,(function(s,l){s?console.error("加载预制体EnemyBullet失败:",s):(n.bossBulletPrefab=l,t=c(n.bossBulletPrefab),n.createBossBulletInstances(t,e))}))))},i.createBossBulletInstances=function(e,t){var n=this._bulletInstances[t.id]=e.getComponent(f);n.init(t),n.onBulletRemoveCB(this.bulletRemoveCB,this),this.node.addChild(e)},i.bulletRemoveCB=function(e){delete this._bulletInstances[e]},i.removeOneBullet=function(e){var t=this._bulletInstances[e];console.log("removeOneBullet arrowId:"+e),t&&(console.log("removeOneBullet aaa"),t.removeBossBullet())},o(t,[{key:"bulletInstances",get:function(){return this._bulletInstances}}]),t}(B)).prototype,"hpBarSystem",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=m))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/Enemy.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TweenPool.ts","./gameConfig.ts"],(function(t){var e,s,o,n,i,r,a,h,c,l,d;return{setters:[function(t){e=t.inheritsLoose},function(t){s=t.cclegacy,o=t._decorator,n=t.Sprite,i=t.Collider2D,r=t.Vec3,a=t.Color,h=t.tween,c=t.Component},function(t){l=t.TweenPool},function(t){d=t.gameConfig}],execute:function(){var u;s._RF.push({},"6b8f2DsPoVCrb+5/T3rhIoT","Enemy",void 0);var _=o.ccclass;o.property,t("Enemy",_("Enemy")(u=function(t){function s(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).collider=void 0,e.sprite=void 0,e._onEnemyRemoveCB=void 0,e._target=void 0,e.id=void 0,e.state=void 0,e.now=0,e._startPos=new r,e._endPos=new r,e._tweens=new l,e._targetPos=new r,e._moveQueue=[],e._isMoving=!1,e.lastTotalTime=0,e._lastAni=void 0,e._isRemoved=!1,e}e(s,t);var o=s.prototype;return o.getId=function(){return this.id},o.setTargetPos=function(t){this._targetPos.set(t)},o.onLoad=function(){this.sprite=this.node.getComponent(n),this.collider=this.node.getComponent(i)},o.onEnable=function(){},o.start=function(){},o.init=function(t,e){this._isRemoved=!1,this._tweens.clear(),this.id=t.id,this.state=t,this._startPos.set(t.pos.x,t.pos.y),this._endPos.set(t.targetPos.x,t.targetPos.y),this.node.position=this._startPos,this.node.scale=new r(1,1,1),this.sprite?t.isUpgradeEnemy?this.sprite.color=a.RED:this.sprite.color=a.WHITE:console.error("Sprite 组件未找到！")},o.onEnemyRemoveCB=function(t,e){this._onEnemyRemoveCB=t,this._target=e},o.updateState=function(t,e){this.state=t,this.now=e,this._tweenState()},o._tweenState=function(){var t=this;if(this._targetPos.x!==this.state.pos.x||this._targetPos.y!==this.state.pos.y){this._tweens.clear();var e=new r(this.state.pos.x,this.state.pos.y);this._targetPos.set(e),this.setStatus("run"),this._tweens.add(h(this.node).to(1/d.syncRate,{position:this._targetPos}).call((function(){t.setStatus("idle")})).start())}},o.setStatus=function(t){},o.playEnemyFallTween=function(){this.collider.enabled=!1,h(this.node).to(.5,{scale:new r(.2,.2,.2)}).call(this.enemyFallTweenComplete.bind(this)).start()},o.remove=function(){var t,e=this;this._isRemoved||(this._isRemoved=!0,this._tweens.clear(),this.node.removeFromParent(),null==(t=this._onEnemyRemoveCB)||t.call(this._target,this.getId()),this.scheduleOnce((function(){e.node.active=!1}),1))},o.enemyFallTweenComplete=function(t){this.remove()},s}(c))||u);s._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyBullet.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,o,s,n,r;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,o=t._decorator,s=t.Collider2D,n=t.Vec3,r=t.Component}],execute:function(){var d;i._RF.push({},"4f832S8JZ9JD4HdmqIZeDZQ","EnemyBullet",void 0);var l=o.ccclass;o.property,t("EnemyBullet",l("EnemyBullet")(d=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).id=void 0,e.state=void 0,e._onBulletRemoveCB=void 0,e._target=void 0,e.collider=void 0,e._startPos=new n,e._endPos=new n,e.dir=void 0,e.dirX=0,e.dirY=0,e}e(i,t);var o=i.prototype;return o.getId=function(){return this.id},o.onLoad=function(){this.collider=this.node.getComponent(s)},o.start=function(){},o.init=function(t){this.id=t.id,this.state=t,this._startPos.set(t.pos.x,t.pos.y),this._endPos.set(t.targetPos.x,t.targetPos.y),this.node.position=this._startPos},o.onBulletRemoveCB=function(t,e){this._onBulletRemoveCB=t,this._target=e},o.update=function(t){this.updatePlayerBulletPos()},o.updatePlayerBulletPos=function(){var t=this._endPos.x-this.node.position.x,e=this._endPos.y-this.node.position.y,i=t*t+e*e;if(i<=1)this.removeBossBullet();else{if(!this.dir){var o=Math.sqrt(i);this.dirX=t/o,this.dirY=e/o,this.dir={x:this.dirX,y:this.dirY}}var s;s=100>=i?new n(this._endPos.x,this._endPos.y):new n(this.node.position.x+10*this.dirX,this.node.position.y+10*this.dirY),this.node.setPosition(s)}},o.removeBossBullet=function(){var t;this.collider.enabled=!1,null==(t=this._onBulletRemoveCB)||t.call(this._target,this.getId()),this.node.removeFromParent(),this.node.destroy()},i}(r))||d);i._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyState.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"27033oBoo1Ld5Xt4sefC1t7","EnemyState",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/env.ts",["cc","./index.mjs"],(function(){var e;return{setters:[function(n){e=n.cclegacy},null],execute:function(){e._RF.push({},"0688cAvpN9MyYYi1PzlVhOQ","env",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/Flight.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TweenPool.ts","./gameConfig.ts","./Enemy.ts","./Boss.ts","./EnemyBullet.ts","./HpBarSystem.ts"],(function(t){var e,i,n,o,l,s,a,r,h,c,d,u,g,p,f,y,_,C,B,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){l=t.cclegacy,s=t._decorator,a=t.Animation,r=t.Vec3,h=t.Collider2D,c=t.Contact2DType,d=t.tween,u=t.RigidBody2D,g=t.Vec2,p=t.Component},function(t){f=t.TweenPool},function(t){y=t.gameConfig},function(t){_=t.Enemy},function(t){C=t.Boss},function(t){B=t.EnemyBullet},function(t){m=t.HpBarSystem}],execute:function(){var v,F,w,S,b,A,P;l._RF.push({},"bffafR8+DBI4ag+n/Fp++9N","Flight",void 0);var T=s.ccclass,I=s.property;t("Flight",(v=T("Flight"),F=I(m),w=I(a),v((A=e((b=function(t){function e(){for(var e,i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return e=t.call.apply(t,[this].concat(l))||this,n(e,"hpBarSystem",A,o(e)),n(e,"ani",P,o(e)),e.collider=void 0,e.playerId=void 0,e.isSelf=!1,e.state=void 0,e.now=0,e._tweens=new f,e._targetPos=new r,e._onAddOneBulletCB=void 0,e._onFlightRemoveCB=void 0,e._target=void 0,e._onFlightCollide=void 0,e._lastAni=void 0,e}i(e,t);var l=e.prototype;return l.getPlayerId=function(){return this.playerId},l.setTargetPos=function(t){this._targetPos=t},l.init=function(t,e){this.playerId=t,this.isSelf=e,e&&this.schedule(this.sendAddOneBullReqetReq,.8)},l.sendAddOneBullReqetReq=function(){var t;"idle"!=this._lastAni&&(null==(t=this._onAddOneBulletCB)||t.call(this._target,this.playerId))},l.onAddOneBulletCallback=function(t,e){this._onAddOneBulletCB=t,this._target=e},l.getIsSelf=function(){return this.isSelf},l.updateState=function(t,e){this.isSelf?this._resetState(t,e):this._tweenState(t,e)},l.onLoad=function(){},l.onEnable=function(){this.collider=this.node.getComponent(h),this.collider.on(c.BEGIN_CONTACT,this.beginContact,this)},l.start=function(){},l.onDisable=function(){this.collider.off(c.BEGIN_CONTACT,this.beginContact,this)},l.onFlightCollideCallback=function(t,e){this._onFlightCollide=t,this._target=e},l.onFlightRemoveCB=function(t,e){this._onFlightRemoveCB=t,this._target=e},l.updateFlightHp=function(t,e){this.hpBarSystem.updateHealth(t,e)},l.beginContact=function(t,e){var i,n,o=this.getPlayerId(),l=e.node,s=l.getComponent(_),a=l.getComponent(C),r=l.getComponent(B);if(s)i=s.getId(),null==(n=this._onFlightCollide)||n.call(this._target,o,i,y.CollisionType.FlightAndEnemy);else if(a){var h;i=a.getId(),null==(h=this._onFlightCollide)||h.call(this._target,o,i,y.CollisionType.FlightAndBoss)}else if(r){var c;i=r.getId(),null==(c=this._onFlightCollide)||c.call(this._target,o,i,y.CollisionType.FlightAndBossBullet)}},l.playFallTween=function(){this.collider.enabled=!1,d(this.node).to(.5,{scale:new r(.2,.2,.2)}).call(this.fallTweenComplete.bind(this)).start()},l.fallTweenComplete=function(){var t;console.log("fallTweenComplete"),this.node.active=!1;var e=this.node.getComponent(u);e.gravityScale=0,e.linearVelocity=new g(0,0),e.angularVelocity=0,null==(t=this._onFlightRemoveCB)||t.call(this._target,this.getPlayerId())},l._resetState=function(t,e){this.node.position.x===t.pos.x&&this.node.position.y===t.pos.y||(this.setStatus(t.rollD),this.node.setPosition(t.pos.x,t.pos.y))},l._tweenState=function(t,e){if(this._targetPos.x!==t.pos.x||this._targetPos.y!==t.pos.y){this._tweens.clear(),this.setStatus(t.rollD),this.node.setPosition(this._targetPos);var i=new r(t.pos.x,t.pos.y);this._targetPos.set(i),this._tweens.add(d(this.node).to(1/y.syncRate,{position:this._targetPos}).call((function(){})).start())}},l.setStatus=function(t){this._lastAni!==t&&(this._lastAni=t,this.ani.stop(),"idle"===t?this.ani.play("idle"):"left"===t?this.ani.play("rollleft"):"right"===t?this.ani.play("rollright"):""===t&&this.ani.play("attack"))},e}(p)).prototype,"hpBarSystem",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=e(b.prototype,"ani",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=b))||S));l._RF.pop()}}}));

System.register("chunks:///_virtual/Game.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Player.ts","./gameConfig.ts","./Flight.ts","./Enemy.ts","./Joystick.ts","./Boss.ts","./Enemies.ts"],(function(e){var t,n,a,s,i,o,r,l,g,m,h,c,u,p,y,d,f,b,B,P,_,v,I;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,s=e.assertThisInitialized,i=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,r=e._decorator,l=e.Node,g=e.Vec2,m=e.Button,h=e.Label,c=e.Vec3,u=e.resources,p=e.Prefab,y=e.instantiate,d=e.Component},function(e){f=e.Player},function(e){b=e.gameConfig},function(e){B=e.Flight},function(e){P=e.Enemy},function(e){_=e.Joystick},function(e){v=e.Boss},function(e){I=e.Enemies}],execute:function(){var C,M,S,w,E,F,R,L,N,x,H,T,D,k,A,O,G,z,q;o._RF.push({},"85bc2BycvxCnZcYPCUaIj6h","Game",void 0);var j=r.ccclass,J=r.property;e("Game",(C=j("Game"),M=J(l),S=J(l),w=J(l),E=J(l),F=J(l),R=J(_),L=J(l),N=J(l),C((T=t((H=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,a(t,"playerNode",T,s(t)),a(t,"enemiesNode",D,s(t)),a(t,"roomIdLabel",k,s(t)),a(t,"player1Score",A,s(t)),a(t,"player2Score",O,s(t)),a(t,"joystick",G,s(t)),a(t,"pauseBtn",z,s(t)),a(t,"continueBtn",q,s(t)),t.gameManager=void 0,t._player=void 0,t._selfSpeed=new g(0,0),t._selfRollD="",t._playerInstances={},t._enemies=void 0,t._bossInstances={},t._enemyInstances={},t.plane1Pfb=void 0,t.isLoadingPlane1=!1,t.plane2Pfb=void 0,t.isLoadingPlane2=!1,t.boss01Prefab=void 0,t.isLoadingBoss1=!1,t.enemy01Prefab=void 0,t.isLoadingEnemy1=!1,t.enemy02Prefab=void 0,t.isLoadingEnemy2=!1,t.enemy03Prefab=void 0,t.isLoadingEnemy3=!1,t}n(t,e);var o=t.prototype;return o.onDisable=function(){},o.onLoad=function(){var e=this;this.joystick.options={onOperate:function(t){e._selfSpeed||(e._selfSpeed=new g),e._selfSpeed.set(t.x,t.y)},onOperateEnd:function(){e._selfRollD="idle",e._selfSpeed=void 0}},this.pauseBtn.on(m.EventType.CLICK,this.onPauseBtnClick,this),this.continueBtn.on(m.EventType.CLICK,this.onContinueBtnClick,this),this._player=this.playerNode.getComponent(f),this._player.onFlightBulletCollideCallback(this.onFlightBulletCollide,this),this._enemies=this.enemiesNode.getComponent(I)},o.onPauseBtnClick=function(){this.pauseBtn.active=!1,this.continueBtn.active=!0},o.onContinueBtnClick=function(){this.continueBtn.active=!1,this.pauseBtn.active=!0},o.init=function(e){var t=this;this.gameManager=e,this.gameManager.onRequestGameStartCallback(this.onRequestGameStartCB,this),this.gameManager.gameSystem.onNewArrow.push((function(e){t._onNewArrow(e)})),this.gameManager.gameSystem.onRemoveEnemy.push((function(e){t._onRemoveEnemy(e)})),this.gameManager.gameSystem.onFlightBulletHitEnemy.push((function(e,n,a){t._onFlightBulletHitEnemy(e,n,a)})),this.gameManager.gameSystem.onFlightBulletHitBoss.push((function(e,n,a){t._onFlightBulletHitBoss(e,n,a)})),this.gameManager.gameSystem.onAnyOneHitPlayer.push((function(e,n,a){t._onAnyOneHitPlayer(e,n,a)})),this.gameManager.gameSystem.onNewBossBullet.push((function(e){t._onNewBossBullet(e)})),this.gameManager.gameSystem.updateBossesPos.push((function(){t._updateBossesPos()})),this.gameManager.gameSystem.updateEnemysPos.push((function(){t._updateEnemysPos()})),this.gameManager.gameSystem.onGameOver.push((function(e,n){t._onGameOver(e,n)}))},o.enterRoom=function(){if(this.gameManager&&this.gameManager.state.gameState==b.gameStateNoStart){var e={roomId:this.gameManager.getSelfRoomId(),userId:this.gameManager.selfPlayerId};0==this.gameManager.getIsSinglePlayerMode()?this.gameManager.requestGameStart(e):this.gameManager.startGame(e)}},o.onRequestGameStartCB=function(){console.log("onRequestGameStartCB")},o.onEnable=function(){this.roomIdLabel.getComponent(h).string="房间号："+this.gameManager.getSelfRoomId()},o.start=function(){},o.update=function(e){this.gameManager&&this.gameManager.state.gameState==b.gameStatePlaying&&(this._selfSpeed&&this._selfSpeed.lengthSqr()?(this._selfRollD="",this._selfSpeed.x>50?this._selfRollD="right":this._selfSpeed.x<-50&&(this._selfRollD="left"),this.gameManager.sendClientInput({type:"PlayerMove",speed:{x:this._selfSpeed.x,y:this._selfSpeed.y},rollD:this._selfRollD,dt:e})):"idle"===this._selfRollD&&(this.gameManager.sendClientInput({type:"PlayerMove",speed:{x:0,y:0},rollD:this._selfRollD,dt:e}),this._selfRollD="-1"),this._updatePlayersPos())},o._updatePlayersPos=function(){for(var e,t=this,n=this.gameManager.state.players,a=function(){var n=e.value;if(n&&0==n.deadFlg){var a,s=t._playerInstances[n.id];if(s)s.updateState(n,t.gameManager.state.now);else 1===n.planeId?t.plane1Pfb?(a=y(t.plane1Pfb),t.createPlayerInstances(a,n)):0==t.isLoadingPlane1&&(t.isLoadingPlane1=!0,u.load("prefabs/Flight1",p,(function(e,s){e?console.error("加载预制体Flight1失败:",e):(t.plane1Pfb=s,a=y(t.plane1Pfb),t.createPlayerInstances(a,n))}))):2===n.planeId&&(t.plane2Pfb?(a=y(t.plane2Pfb),t.createPlayerInstances(a,n)):0==t.isLoadingPlane2&&(t.isLoadingPlane2=!0,u.load("prefabs/Flight2",p,(function(e,s){e?console.error("加载预制体Flight2失败:",e):(t.plane2Pfb=s,a=y(t.plane2Pfb),t.createPlayerInstances(a,n))}))))}},s=i(n);!(e=s()).done;)a()},o.createPlayerInstances=function(e,t){var n,a=new c(t.pos.x,t.pos.y,0);e.position=a;var s=t.id;(n=this._playerInstances[t.id]=e.getComponent(B)).setTargetPos(a),n.onAddOneBulletCallback(this.onAddOneBulletCB,this),n.onFlightCollideCallback(this.onFlightCollide,this),n.onFlightRemoveCB(this.flightRemoveCB,this),n.init(s,s===this.gameManager.selfPlayerId),this.playerNode.addChild(e),s==this.gameManager.selfPlayerId?this.player1Score.getComponent(h).string="我:"+t.score:this.player2Score.getComponent(h).string="他:"+t.score,n.updateFlightHp(t.hp,t.maxHp)},o._updateBossesPos=function(){for(var e,t=this.gameManager.state.bosses,n=t.length-1;n>-1;n--)e=t[n],this._onNewBoss(e)},o._updateEnemysPos=function(){for(var e,t=this.gameManager.state.enemys,n=t.length-1;n>-1;n--)e=t[n],this._onNewEnemy(e)},o._onNewArrow=function(e){var t,n=this.gameManager.state.players.find((function(t){return t.id===e.fromPlayerId}));n&&((null==(t=this._playerInstances[n.id])?void 0:t.node)&&this._player.addOneBullet(e))},o._onNewBossBullet=function(e){var t,n=this.gameManager.state.bosses.find((function(t){return t.id===e.fromPlayerId}));n?(null==(t=this._bossInstances[n.id])?void 0:t.node)?this._enemies.addOneBullet(e):console.log("------_onNewBossBullet 没有找到该bossNode"):console.log("------_onNewBossBullet 没有找到该bossState")},o._onNewBoss=function(e){var t,n=this,a=this._bossInstances[e.id];a?a.updateState(e,this.gameManager.state.now):this.boss01Prefab?(t=y(this.boss01Prefab),(a=this.createBossInstances(t,e)).updateState(e,this.gameManager.state.now)):0==this.isLoadingBoss1&&(this.isLoadingBoss1=!0,u.load("prefabs/Boss01",p,(function(s,i){s?console.error("加载预制体Boss01失败:",s):(n.boss01Prefab=i,t=y(n.boss01Prefab),(a=n.createBossInstances(t,e)).updateState(e,n.gameManager.state.now))})))},o.createBossInstances=function(e,t){var n=new c(t.pos.x,t.pos.y,0),a=this._bossInstances[t.id]=e.getComponent(v);return a.setTargetPos(n),a.onBossRemoveCB(this.enemyRemoveCB,this),this.enemiesNode.addChild(e),a.init(t,this.gameManager.state.now),this._enemies.updateBossHp(t.hp,t.maxHp),a},o._onNewEnemy=function(e){var t,n=this,a=this._enemyInstances[e.id];a?a.updateState(e,this.gameManager.state.now):1==e.planeType?this.enemy01Prefab?(t=y(this.enemy01Prefab),(a=this.createEnemyInstances(t,e)).updateState(e,this.gameManager.state.now)):0==this.isLoadingEnemy1&&(this.isLoadingEnemy1=!0,u.load("prefabs/Enemy01",p,(function(s,i){s?console.error("加载预制体Enemy01失败:",s):(n.enemy01Prefab=i,t=y(n.enemy01Prefab),(a=n.createEnemyInstances(t,e)).updateState(e,n.gameManager.state.now))}))):2==e.planeType?this.enemy02Prefab?(t=y(this.enemy02Prefab),(a=this.createEnemyInstances(t,e)).updateState(e,this.gameManager.state.now)):0==this.isLoadingEnemy2&&(this.isLoadingEnemy2=!0,u.load("prefabs/Enemy02",p,(function(s,i){s?console.error("加载预制体Enemy02失败:",s):(n.enemy02Prefab=i,t=y(n.enemy02Prefab),(a=n.createEnemyInstances(t,e)).updateState(e,n.gameManager.state.now))}))):3==e.planeType&&(this.enemy03Prefab?(t=y(this.enemy03Prefab),(a=this.createEnemyInstances(t,e)).updateState(e,this.gameManager.state.now)):0==this.isLoadingEnemy3&&(this.isLoadingEnemy3=!0,u.load("prefabs/Enemy03",p,(function(s,i){s?console.error("加载预制体Enemy03失败:",s):(n.enemy03Prefab=i,t=y(n.enemy03Prefab),(a=n.createEnemyInstances(t,e)).updateState(e,n.gameManager.state.now))}))))},o.createEnemyInstances=function(e,t){var n=new c(t.pos.x,t.pos.y,0),a=this._enemyInstances[t.id]=e.getComponent(P);return a.setTargetPos(n),a.onEnemyRemoveCB(this.enemyRemoveCB,this),this.enemiesNode.addChild(e),a.init(t,this.gameManager.state.now),a},o._onRemoveEnemy=function(e){var t=this._enemyInstances[e.id];t&&t.remove()},o._onFlightBulletHitEnemy=function(e,t,n){this._player.removePlayerBullet(t);var a=this._enemyInstances[n];a&&a.playEnemyFallTween();var s=this.gameManager.state.players.find((function(t){return t.id===e}));s&&(e==this.gameManager.selfPlayerId?this.player1Score.getComponent(h).string="我:"+s.score:this.player2Score.getComponent(h).string="他:"+s.score)},o._onFlightBulletHitBoss=function(e,t,n){if(this._player.removePlayerBullet(t),this._bossInstances[n]){var a=this.gameManager.state.bosses.find((function(e){return e.id===n}));a&&(this._enemies.updateBossHp(a.hp,a.maxHp),a.deadFlg)}var s=this.gameManager.state.players.find((function(t){return t.id===e}));s&&(e==this.gameManager.selfPlayerId?this.player1Score.getComponent(h).string="我:"+s.score:this.player2Score.getComponent(h).string="他:"+s.score)},o._onAnyOneHitPlayer=function(e,t,n){console.log("------_onAnyOneHitPlayer playerId:"+e+" otherId:"+t);var a=this._playerInstances[e];if(a){var s=this.gameManager.state.players.find((function(t){return t.id===e}));s&&(a.updateFlightHp(s.hp,s.maxHp),s.hp<=0&&a.playFallTween())}if(n==b.CollisionType.FlightAndEnemy){var i=this._enemyInstances[t];i&&i.playEnemyFallTween()}else n==b.CollisionType.FlightAndBoss||n==b.CollisionType.FlightAndBossBullet&&this._enemies.removeOneBullet(t)},o.onDestroy=function(){this.unscheduleAllCallbacks()},o.onAddOneBulletCB=function(e){if(this.gameManager.state.gameState==b.gameStatePlaying){var t=this.gameManager.selfPlayerId;if(e==t){var n,a=this.gameManager.state.players.find((function(t){return t.id===e}));if(!a)return;var s=null==(n=this._playerInstances[e])?void 0:n.node;if(!s||0==s.active)return;var i=new g(0,b.playBulletDis),o=new g(a.pos.x,a.pos.y).add2f(i.x,i.y);this.gameManager.sendClientInput({type:"PlayerAttack",bulletNum:1,pos:{x:a.pos.x,y:a.pos.y},targetPos:{x:o.x,y:o.y},targetTime:this.gameManager.state.now+b.playBulletFlyTime})}}},o.onFlightBulletCollide=function(e,t,n){this.gameManager.sendClientInput({type:"BeginContact",contactNum:n,id1:e,id2:t,nowTime:this.gameManager.state.now})},o.onFlightCollide=function(e,t,n){this.gameManager.state.gameState==b.gameStatePlaying&&this.gameManager.sendClientInput({type:"BeginContact",contactNum:n,id1:e,id2:t,nowTime:this.gameManager.state.now})},o.flightRemoveCB=function(e){console.log("flightRemoveCB playerId:"+e),this.gameManager.state.gameState,b.gameStatePlaying},o.enemyRemoveCB=function(e){delete this._enemyInstances[e]},o._onGameOver=function(e,t){for(var n in console.log("Client Game over, winnerPlayerId:"+e," maxScore:"+t),this._enemyInstances){var a=this._enemyInstances[n];a&&a.remove()}},t}(d)).prototype,"playerNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(H.prototype,"enemiesNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=t(H.prototype,"roomIdLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=t(H.prototype,"player1Score",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=t(H.prototype,"player2Score",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=t(H.prototype,"joystick",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=t(H.prototype,"pauseBtn",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=t(H.prototype,"continueBtn",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=H))||x));o._RF.pop()}}}));

System.register("chunks:///_virtual/gameConfig.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"b14a4zfrL5Iaq07A9ybmJ7Y","gameConfig",void 0);e("gameConfig",{designWidth:750,designHeight:1334,syncRate:10,gameDuration:3e5,CollisionType:{FlightBulletAndEnemy:1,FlightAndEnemy:2,FlightAndBoss:3,FlightBulletAndBoss:4,FlightAndBossBullet:5},playerState:{normal:0,dizzy:1},gameStateNoStart:0,gameStateReady:1,gameStatePlaying:2,gameStateEnd:3,moveSpeed:100,playBulletFlyTime:680,playBulletDis:400});t._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index2.mjs","./index3.mjs","./GameSystem.ts","./serviceProto.ts","./gameConfig.ts"],(function(e){var t,n,s,r,a,i,o,l,c,m;return{setters:[function(e){t=e.asyncToGenerator,n=e.regeneratorRuntime,s=e.createForOfIteratorHelperLoose,r=e.extends,a=e.createClass},function(e){i=e.cclegacy},function(e){o=e.WsClient},null,function(e){l=e.GameSystem},function(e){c=e.serviceProto},function(e){m=e.gameConfig}],execute:function(){i._RF.push({},"53b02ucwshGOrY81/dGIG58","GameManager",void 0);e("GameManager",function(){var e=i.prototype;function i(){this.client=void 0,this.gameSystem=new l,this.lastServerState=this.gameSystem.state,this.lastRecvSetverStateTime=0,this.selfPlayerId=-1,this.selfRoomId=-1,this.lastSN=0,this._onJoinCB=void 0,this._target=void 0,this._onRequestGameStartCB=void 0,this._targetRoom=void 0,this._isSinglePlayerMode=!1,this.syncRate=m.syncRate,this.nextEnemyId=1,this.nextBossId=1,this.gameOverTime=void 0,this.syncInterval=void 0,this.enemyInterval=void 0,this.enemysSpeed=[1,2,3],this.pendingInputs=[],this.frameArry=[],this.lastTotalTime=0,this.pendingInputMsgs=[]}return e.getSelfRoomId=function(){return this.selfRoomId},e.getIsSinglePlayerMode=function(){return this._isSinglePlayerMode},e.setIsSinglePlayerMode=function(e){this._isSinglePlayerMode=e},e.connectServer=function(){var e=this;if(0==this._isSinglePlayerMode){var s,r=this.client=new o(c,{server:"ws://test44.44vs.com:3000",json:!0,heartbeat:{interval:1e3,timeout:5e3}});r.listenMsg("server/Frame",(function(t){e._onServerSync(t)}));var a=parseInt((null==(s=location.search.match(/\blag=(\d+)/))?void 0:s[1])||"0");a&&(r.flows.preRecvDataFlow.push(t(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,a)}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))),r.flows.preSendDataFlow.push(t(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,a)}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)}))))),window.gm=this}},e.findRoom=function(){var e=t(n().mark((function e(t){var s,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client||this.connectServer(),this.client.isConnected){e.next=9;break}return e.next=4,this.client.connect();case 4:if(e.sent.isSucc){e.next=9;break}return e.next=8,new Promise((function(e){setTimeout(e,2e3)}));case 8:return e.abrupt("return",this.findRoom(t));case 9:return e.next=11,this.client.callApi("FindRoom",t);case 11:if((s=e.sent).isSucc){e.next=17;break}return alert(s.err.message),e.abrupt("return");case 17:console.log("加入房间成功"),this.gameSystem.reset(s.res.gameState),this.lastServerState=Object.merge(s.res.gameState),this.lastRecvSetverStateTime=Date.now(),this.selfPlayerId=t.userId,this.selfRoomId=s.res.roomId,console.log("findRoom roomId:"+this.selfRoomId),null==(r=this._onJoinCB)||r.call(this._target);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.join=function(){var e=t(n().mark((function e(t){var s,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client||this.connectServer(),this.client.isConnected){e.next=9;break}return e.next=4,this.client.connect();case 4:if(e.sent.isSucc){e.next=9;break}return e.next=8,new Promise((function(e){setTimeout(e,2e3)}));case 8:return e.abrupt("return",this.join(t));case 9:return e.next=11,this.client.callApi("Join",t);case 11:if((s=e.sent).isSucc){e.next=17;break}return alert(s.err.message),e.abrupt("return");case 17:console.log("加入房间成功"),this.gameSystem.reset(s.res.gameState),this.lastServerState=Object.merge(s.res.gameState),this.lastRecvSetverStateTime=Date.now(),this.selfPlayerId=t.userId,this.selfRoomId=s.res.roomId,console.log("join roomId:"+this.selfRoomId),null==(r=this._onJoinCB)||r.call(this._target);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.enterJoinSingle=function(e){var t,n=e.userId,s={type:"PlayerJoin",playerId:n,planeId:Math.floor(2*Math.random())+1,pos:{x:200*Math.random()-100,y:10*Math.random()-230},score:0,mainBulletNum:1,mainBulletInterval:.8};this.applyInput(s),console.log("applyInput:PlayerJoin"),this.selfPlayerId=n,this.selfRoomId=100,console.log("join roomId:"+this.selfRoomId),null==(t=this._onJoinCB)||t.call(this._target)},e.onJoinCallback=function(e,t){this._onJoinCB=e,this._target=t},e.startGame=function(e){var t,n=this,s={type:"GameStart",modelType:1,playerId:e.userId};this.applyInput(s),console.log("startGame:GameStart");var r={type:"BossJoin",bossId:this.nextBossId++,monsterId:1};this.applyInput(r),console.log("startGame:BossJoin"),this.gameOverTime||(console.log("gameOverTime is running"),this.gameOverTime=setTimeout((function(){n.gameOver()}),m.gameDuration),this.syncInterval||(console.log("syncInterval is running"),this.syncInterval=setInterval((function(){n.sync()}),1e3/this.syncRate)),this.enemyInterval||(console.log("enemyInterval is running"),this.enemyInterval=setInterval((function(){n.addOneEnemyPrefab()}),1e3))),null==(t=this._onRequestGameStartCB)||t.call(this._targetRoom)},e.applyInput=function(e){this.pendingInputs.push(e)},e.requestGameStart=function(){var e=t(n().mark((function e(t){var s,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.isConnected){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.client.callApi("GameStart",t);case 4:if((s=e.sent).isSucc){e.next=10;break}return alert(s.err.message),e.abrupt("return");case 10:console.log("游戏开始成功"),this.gameSystem.reset(s.res.gameState),this.lastServerState=Object.merge(s.res.gameState),this.lastRecvSetverStateTime=Date.now(),console.log("requestGameStart roomId:"+this.selfRoomId),null==(r=this._onRequestGameStartCB)||r.call(this._targetRoom);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.onRequestGameStartCallback=function(e,t){this._onRequestGameStartCB=e,this._targetRoom=t},e.gameOver=function(){this.gameOverTime&&(clearTimeout(this.gameOverTime),this.gameOverTime=void 0),this.enemyInterval&&(clearInterval(this.enemyInterval),this.enemyInterval=void 0),console.log("游戏结束");var e=-1,t=-1;if(this.gameSystem.state.players.length>0){var n=this.gameSystem.getWinnerPlayerState();null!=n&&(e=n.id,t=n.score)}console.log("game over winnerPlayerId:"+e),console.log("game over maxScore:"+t),this.applyInput({type:"GameOver",winnerPlayerId:e,maxScore:t}),console.log("applyInput:GameOver")},e.addOneEnemyPrefab=function(){if(this.gameSystem.state.players.length>0){var e=Math.floor(3*Math.random())+1,t=this.enemysSpeed[e-1],n=Math.floor(180*Math.random())+100,s=m.designHeight/2,r=Math.floor(Math.random()*m.designWidth)-m.designWidth/2,a=-m.designHeight/2+100,i=Math.random()<.1,o={type:"EnemyEnemyJoin",playerId:this.nextEnemyId++,planeType:e,speed:t,pos:{x:n,y:s},targetPos:{x:r,y:a},isUpgradeEnemy:i};this.applyInput(o)}},e.sync=function(){var e=this,t=this.pendingInputs;this.pendingInputs=[],this.gameSystem.setIsLastFrameMsg(!0),t.forEach((function(t){e.gameSystem.applyInput(t)})),this.gameSystem.state.gameState==m.gameStateEnd?this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=void 0):this.localTimePast()},e.localTimePast=function(){var e=Date.now()-this.lastRecvSetverStateTime;this.applyInput({type:"TimePast",dt:e}),this.lastRecvSetverStateTime=Date.now()},e._onServerSync=function(e){this.frameArry.push(e),1==e.msgEnd&&this.handleServerSync()},e.handleServerSync=function(){var e,t=this;this.gameSystem.reset(this.lastServerState);for(var n=-1,a=0;a<this.frameArry.length;a++){var i;e=this.frameArry[a],this.gameSystem.setIsLastFrameMsg(e.msgEnd);for(var o,l=s(e.inputs);!(o=l()).done;){var c=o.value;this.gameSystem.applyInput(c)}n=null!=(i=e.lastSn)?i:-1}this.frameArry.length=0,this.lastServerState=Object.merge({},this.gameSystem.state),this.lastRecvSetverStateTime=Date.now();var m=n;this.pendingInputMsgs.remove((function(e){return e.sn<=m})),this.pendingInputMsgs.forEach((function(e){e.inputs.forEach((function(e){t.gameSystem.applyInput(r({},e,{playerId:t.selfPlayerId}))}))}))},e.sendClientInput=function(e){var t=this;if(0!=this._isSinglePlayerMode||this.selfPlayerId&&this.client.isConnected){var n=this.gameSystem.state.players.find((function(e){return e.id===t.selfPlayerId}));if(n&&!n.deadFlg){if(0==this._isSinglePlayerMode){var s={sn:++this.lastSN,inputs:[e]};this.pendingInputMsgs.push(s),this.client.sendMsg("client/ClientInput",s)}this.gameSystem.applyInput(r({},e,{playerId:this.selfPlayerId}))}}},a(i,[{key:"state",get:function(){return this.gameSystem.state}}]),i}());i._RF.pop()}}}));

System.register("chunks:///_virtual/GameRecord.ts",["cc"],(function(){var e;return{setters:[function(c){e=c.cclegacy}],execute:function(){e._RF.push({},"05509TQCUxGA76kch9D3ISj","GameRecord",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/GameSystem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./gameConfig.ts"],(function(t){var e,s,a,r,i;return{setters:[function(t){e=t.extends,s=t.createForOfIteratorHelperLoose,a=t.createClass},function(t){r=t.cclegacy},function(t){i=t.gameConfig}],execute:function(){r._RF.push({},"e1831977jJFfIXfHC8xvMI5","GameSystem",void 0);t("GameSystem",function(){function t(){this._isLastFrameMsg=!1,this._state={now:0,gameState:0,players:[],bosses:[],bossBullets:[],nextBossBulletId:1,enemys:[],arrows:[],nextArrowId:1},this.onNewArrow=[],this.onRemoveEnemy=[],this.onFlightBulletHitEnemy=[],this.onFlightBulletHitBoss=[],this.onAnyOneHitPlayer=[],this.onNewBossBullet=[],this.updateBossesPos=[],this.updateEnemysPos=[],this.onGameOver=[]}var r=t.prototype;return r.setIsLastFrameMsg=function(t){this._isLastFrameMsg=t},r.reset=function(t){this._state=Object.merge({},t)},r.getStage=function(t){return t<10?1:t<20?2:t<40?3:t<60?4:t<90?5:t<120?6:t<160?7:t<200?8:t<240?9:10},r.getWinnerPlayerState=function(){var t=null;return this._state.players.forEach((function(e){e.score>-1&&(t=e)})),t},r.applyInput=function(t){var a=this;if("GameStart"===t.type)console.log("GameStart"),this._state.gameState=i.gameStatePlaying;else if("GameOver"===t.type){var r=t.winnerPlayerId,o=t.maxScore;this._state={now:0,gameState:i.gameStateEnd,players:[],bosses:[],bossBullets:[],nextBossBulletId:1,enemys:[],arrows:[],nextArrowId:1},this.onGameOver.forEach((function(t){return t(r,o)}))}else if("PlayerJoin"===t.type)this._state.players.push({id:t.playerId,planeId:t.planeId,pos:e({},t.pos),rollD:"",score:t.score,mainBulletNum:t.mainBulletNum,mainBulletInterval:t.mainBulletInterval,hp:100,maxHp:100,damage:1,deadFlg:!1});else if("BossJoin"===t.type){var n={id:t.bossId,monsterId:t.monsterId,pos:{x:-150,y:450},currStage:0,stage1:{targetX:-150,targetY:0,moveTime:1e3,stayTime:2e3,stayStartTime:-1},stage2:{targetX:-150,targetY:-150,moveTime:1e3,stayTime:2e3,stayStartTime:-1},stage3:{targetX:0,targetY:-150,moveTime:1e3,stayTime:2e3,stayStartTime:-1},stage4:{targetX:-150,targetY:450,moveTime:1e3,stayTime:2e3,stayStartTime:-1},attackInterval:100,lastAttackTime:-1,hp:100,maxHp:100,damage:5,deadFlg:!1};this._state.bosses.push(n)}else if("EnemyEnemyJoin"===t.type){var l={id:t.playerId,planeType:t.planeType,speed:t.speed,pos:e({},t.pos),targetPos:e({},t.targetPos),isUpgradeEnemy:t.isUpgradeEnemy};this._state.enemys.push(l)}else if("PlayerLeave"===t.type)this._state.players.remove((function(e){return e.id===t.playerId}));else if("PlayerMove"===t.type){var u=this._state.players.find((function(e){return e.id===t.playerId}));if(!u)return;if(u.dizzyEndTime&&u.dizzyEndTime>this._state.now)return;var y=t.speed.x,m=t.speed.y;u.pos.x+=y*t.dt,u.pos.y+=m*t.dt,u.rollD=t.rollD}else if("PlayerAttack"===t.type){var p=this._state.players.find((function(e){return e.id===t.playerId}));if(p){var d,g=p.mainBulletNum,h=0;1==g?h=t.targetPos.x:2==g?h=t.targetPos.x-10:3==g&&(h=t.targetPos.x-20);for(var f=0;f<p.mainBulletNum;f++)d={id:this._state.nextArrowId++,bulletType:1,fromPlayerId:t.playerId,pos:{x:t.pos.x,y:t.pos.y+40},targetPos:{x:h+20*f,y:t.targetPos.y},targetTime:t.targetTime},this._state.arrows.push(d),this.onNewArrow.forEach((function(t){return t(d)}))}}else if("BeginContact"===t.type){var c=t.contactNum;if(c==i.CollisionType.FlightBulletAndEnemy||c==i.CollisionType.FlightBulletAndBoss){var _=t.id1,v=t.id2,T=this._state.arrows.find((function(t){return t.id===_})),B=0;if(T){B=T.fromPlayerId;var x=this._state.players.find((function(t){return t.id===B}));if(x){x.score+=1;var w=this.getStage(x.score);if(w<2?x.mainBulletNum=1:w<4?x.mainBulletNum=2:w<6?x.mainBulletNum=3:w<8?x.mainBulletInterval=.6:w<11&&(x.mainBulletInterval=.4),this._state.arrows=this._state.arrows.filter((function(t){return t.id!==_})),c==i.CollisionType.FlightBulletAndEnemy)this._state.enemys=this._state.enemys.filter((function(t){return t.id!==v})),this.onFlightBulletHitEnemy.forEach((function(t){return t(B,_,v)}));else if(c==i.CollisionType.FlightBulletAndBoss){var S=this._state.bosses.find((function(t){return t.id===v}));if(S&&(S.hp-=1,S.hp<=0&&(S.deadFlg=!0),this.onFlightBulletHitBoss.forEach((function(t){return t(B,_,v)})),S.hp<=0)){this._state.bosses.splice(v,1);var I=-1,E=0,P=this.getWinnerPlayerState();null!=P&&(I=P.id,E=P.score),this._state={now:0,gameState:i.gameStateEnd,players:[],bosses:[],bossBullets:[],nextBossBulletId:1,enemys:[],arrows:[],nextArrowId:1},this.onGameOver.forEach((function(t){return t(I,E)}))}}}}}else if(c==i.CollisionType.FlightAndEnemy||c==i.CollisionType.FlightAndBoss||c==i.CollisionType.FlightAndBossBullet){var F=t.id1,A=t.id2,b=this._state.players.find((function(t){return t.id===F}));if(b)if(c==i.CollisionType.FlightAndEnemy?(b.hp-=1,b.hp<=0&&(b.deadFlg=!0),this.onAnyOneHitPlayer.forEach((function(t){return t(F,A,c)})),this._state.enemys.remove((function(t){return t.id===A}))):c==i.CollisionType.FlightAndBoss?(b.hp-=1,b.hp<=0&&(b.deadFlg=!0),this.onAnyOneHitPlayer.forEach((function(t){return t(F,A,c)}))):c==i.CollisionType.FlightAndBossBullet&&(b.hp-=1,b.hp<=0&&(b.deadFlg=!0),this.onAnyOneHitPlayer.forEach((function(t){return t(F,A,c)})),this._state.bossBullets.remove((function(t){return t.id===A}))),this._state.players.every((function(t){return!0===t.deadFlg}))){var C=-1,H=0,N=this.getWinnerPlayerState();null!=N&&(C=N.id,H=N.score),this._state={now:0,gameState:i.gameStateEnd,players:[],bosses:[],bossBullets:[],nextBossBulletId:1,enemys:[],arrows:[],nextArrowId:1},this.onGameOver.forEach((function(t){return t(C,H)}))}}}else if("TimePast"===t.type){this._state.now+=t.dt;for(var M,O=0,k=0,G=0,L=0,X=0,Y=0,D=function(){if(0==(M=a._state.bosses[R]).deadFlg){var e;if(0==M.currStage)e=M.stage1,M.currStage=1,e.stayStartTime=-1;else if(1==M.currStage){var s=M.stage1.stayStartTime;-1!=s&&s+M.stage1.stayTime<a._state.now?(e=M.stage2,M.currStage=2,e.stayStartTime=-1):e=M.stage1}else if(2==M.currStage){var r=M.stage2.stayStartTime;-1!=r&&r+M.stage2.stayTime<a._state.now?(e=M.stage3,M.currStage=3,e.stayStartTime=-1):e=M.stage2}else if(3==M.currStage){var o=M.stage3.stayStartTime;-1!=o&&o+M.stage3.stayTime<a._state.now?(e=M.stage4,M.currStage=4,e.stayStartTime=-1):e=M.stage3}else if(4==M.currStage){var n=M.stage4.stayStartTime;-1!=n&&n+M.stage4.stayTime<a._state.now?(e=M.stage1,M.currStage=1,e.stayStartTime=-1):e=M.stage4}if(e)if(-1==e.stayStartTime)if(M.lastAttackTime=-1,X=e.targetX-M.pos.x,Y=e.targetY-M.pos.y,G=X*X+Y*Y,e.dir?(O=e.dir.x,k=e.dir.y):(L=Math.sqrt(G),O=X/L,k=Y/L,e.dir={x:O,y:k}),G<=100)M.pos.x=e.targetX,M.pos.y=e.targetY,e.stayStartTime=a._state.now;else{var l=t.dt/1e3*180;l*l>=G?(M.pos.x=e.targetX,M.pos.y=e.targetY,e.stayStartTime=a._state.now):(M.pos.x+=O*l,M.pos.y+=k*l)}else if(-1==M.lastAttackTime||M.lastAttackTime+M.attackInterval<a._state.now){var u=Math.floor(Math.random()*i.designWidth)-i.designWidth/2,y=-i.designHeight/2+100,m={id:a._state.nextBossBulletId++,bulletType:1,fromPlayerId:M.id,pos:{x:M.pos.x,y:M.pos.y},targetPos:{x:u,y:y},targetTime:a._state.now+2e3};a._state.bossBullets.push(m),M.lastAttackTime=a._state.now,a.onNewBossBullet.forEach((function(t){return t(m)}))}}},R=this._state.bosses.length-1;R>-1;R--)D();this._isLastFrameMsg&&this.updateBossesPos.forEach((function(t){return t()}));for(var W,z=0,J=0,j=0,U=0,q=0,K=0,Q=!1,V=this._state.enemys.length-1;V>-1;V--){if(W=this._state.enemys[V],Q=!1,W.isUpgradeEnemy)for(var Z,$=function(){var t=Z.value;if(t&&0==t.deadFlg&&"idle"===t.rollD&&(q=t.pos.x-W.pos.x,K=t.pos.y-W.pos.y,(j=q*q+K*K)<=22500)){a._state.enemys.splice(V,1),a.onRemoveEnemy.forEach((function(t){return t(W)})),Q=!0;var e={id:a._state.nextArrowId++,bulletType:2,fromPlayerId:t.id,pos:{x:t.pos.x-20,y:t.pos.y+40},targetPos:{x:t.pos.x-20,y:t.pos.y+1334},targetTime:a._state.now+2e3};return a._state.arrows.push(e),a.onNewArrow.forEach((function(t){return t(e)})),e={id:a._state.nextArrowId++,bulletType:2,fromPlayerId:t.id,pos:{x:t.pos.x+20,y:t.pos.y+40},targetPos:{x:t.pos.x+20,y:t.pos.y+1334},targetTime:a._state.now+2e3},a._state.arrows.push(e),a.onNewArrow.forEach((function(t){return t(e)})),1}},tt=s(this._state.players);!(Z=tt()).done&&!$(););if(0==Q)if(q=W.targetPos.x-W.pos.x,K=W.targetPos.y-W.pos.y,j=q*q+K*K,W.dir?(z=W.dir.x,J=W.dir.y):(U=Math.sqrt(j),z=q/U,J=K/U,W.dir={x:z,y:J}),j<=100)this._state.enemys.splice(V,1),this.onRemoveEnemy.forEach((function(t){return t(W)}));else{var et=60*W.speed*(t.dt/1e3);W.moveDuration=t.dt,et*et>=j?(W.pos.x=W.targetPos.x,W.pos.y=W.targetPos.y):(W.pos.x+=z*et,W.pos.y+=J*et)}}this._isLastFrameMsg&&this.updateEnemysPos.forEach((function(t){return t()}));for(var st=this._state.bossBullets.length-1;st>-1;--st){this._state.bossBullets[st].targetTime<=this._state.now&&this._state.bossBullets.splice(st,1)}for(var at=this._state.arrows.length-1;at>-1;--at){this._state.arrows[at].targetTime<=this._state.now&&this._state.arrows.splice(at,1)}}},a(t,[{key:"state",get:function(){return this._state}}]),t}());r._RF.pop()}}}));

System.register("chunks:///_virtual/HpBarSystem.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,a,l,i,n,h,o,u,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,a=t.initializerDefineProperty,l=t.assertThisInitialized},function(t){i=t.cclegacy,n=t._decorator,h=t.ProgressBar,o=t.Sprite,u=t.Color,s=t.Component}],execute:function(){var c,p,H,f,m,y,d,g,b,B,C,x,S;i._RF.push({},"3d17dSOb6RFlqQoYYskZlIR","HpBarSystem",void 0);var v=n.ccclass,w=n.property;t("HpBarSystem",(c=v("HpBarSystem"),p=w(h),H=w(o),f=w({type:u}),m=w({type:u}),y=w({type:u}),c((b=e((g=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return e=t.call.apply(t,[this].concat(i))||this,a(e,"healthBar",b,l(e)),e.maxHealth=100,e.currentHealth=100,a(e,"fillSprite",B,l(e)),a(e,"fullHealthColor",C,l(e)),a(e,"midHealthColor",x,l(e)),a(e,"lowHealthColor",S,l(e)),e}r(e,t);var i=e.prototype;return i.start=function(){this.currentHealth=this.maxHealth,this.updateHealthBar()},i.updateHealth=function(t,e){this.currentHealth=Math.max(0,Math.min(t,e||this.maxHealth)),e&&(this.maxHealth=e),this.updateHealthBar()},i.takeDamage=function(t){this.currentHealth=Math.max(0,this.currentHealth-t),this.updateHealthBar(),console.log("受到伤害: "+t+", 当前血量: "+this.currentHealth)},i.heal=function(t){this.currentHealth=Math.min(this.maxHealth,this.currentHealth+t),this.updateHealthBar(),console.log("恢复血量: "+t+", 当前血量: "+this.currentHealth)},i.updateHealthBar=function(){if(this.healthBar){var t=this.currentHealth/this.maxHealth;this.healthBar.progress=t,this.updateHealthColor(t)}},i.updateHealthColor=function(t){var e;this.fillSprite&&(e=t>=.6?this.fullHealthColor:t>=.3?this.midHealthColor:this.lowHealthColor,this.fillSprite.color=e)},i.getCurrentHealth=function(){return this.currentHealth},i.getMaxHealth=function(){return this.maxHealth},i.getHealthPercentage=function(){return this.currentHealth/this.maxHealth*100},i.isDead=function(){return this.currentHealth<=0},e}(s)).prototype,"healthBar",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=e(g.prototype,"fillSprite",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=e(g.prototype,"fullHealthColor",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.GREEN}}),x=e(g.prototype,"midHealthColor",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.YELLOW}}),S=e(g.prototype,"lowHealthColor",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.RED}}),d=g))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/Joystick.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var t,n,s,i,c,e,h;return{setters:[function(o){t=o.inheritsLoose,n=o.createClass},function(o){s=o.cclegacy,i=o._decorator,c=o.Vec3,e=o.Node,h=o.Component}],execute:function(){var u;s._RF.push({},"ccc7fTjElVEQqB07I1JvC+N","Joystick",void 0);var a=i.ccclass;i.property,new c,o("Joystick",a("Joystick")(u=function(o){function s(){for(var t,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(t=o.call.apply(o,[this].concat(s))||this)._options=void 0,t._lastTouchPos=void 0,t._lastTouchTime=0,t.MAX_SPEED=60,t}t(s,o);var i=s.prototype;return i.onLoad=function(){this.node.on(e.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(e.EventType.TOUCH_MOVE,this.onTouch,this),this.node.on(e.EventType.TOUCH_END,this.onTouchEnd,this)},i.onTouchStart=function(o){if(o.touch){var t=o.touch.getUILocation(),n=new c(t.x,t.y,0);this._lastTouchPos=n,this._lastTouchTime=performance.now()}},i.onTouch=function(o){if(o.touch){var t=performance.now(),n=o.touch.getUILocation(),s=new c(n.x,n.y,0);if(this._lastTouchPos&&0==this._lastTouchPos.equals(s)){var i,e=(t-this._lastTouchTime)/1e3,h=(s.x-this._lastTouchPos.x)/e,u=(s.y-this._lastTouchPos.y)/e;null==(i=this.options)||i.onOperate({x:h||0,y:u||0})}this._lastTouchPos=s,this._lastTouchTime=t}},i.onTouchEnd=function(o){var t;this._lastTouchPos=void 0,this._lastTouchTime=0,null==(t=this.options)||t.onOperateEnd()},n(s,[{key:"options",get:function(){return this._options},set:function(o){this._options=o}}]),s}(h))||u);s._RF.pop()}}}));

System.register("chunks:///_virtual/Lobby.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts","./Game.ts"],(function(n){var e,i,o,t,a,r,l,s,c,u,g,m;return{setters:[function(n){e=n.applyDecoratedDescriptor,i=n.inheritsLoose,o=n.initializerDefineProperty,t=n.assertThisInitialized},function(n){a=n.cclegacy,r=n._decorator,l=n.Node,s=n.Button,c=n.EditBox,u=n.Component},function(n){g=n.GameManager},function(n){m=n.Game}],execute:function(){var d,h,p,f,y,M,B,b,C,v,k,J,I;a._RF.push({},"ac359Z1EqlP2omGQ432qMzH","Lobby",void 0);var R=r.ccclass,L=r.property;n("Lobby",(d=R("Lobby"),h=L(l),p=L(l),f=L(l),y=L(l),M=L(l),d((C=e((b=function(n){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=n.call.apply(n,[this].concat(a))||this,o(e,"gameRoom",C,t(e)),o(e,"quicklyJoinBtn",v,t(e)),o(e,"findJoinBtn",k,t(e)),o(e,"inputRoomIdTxt",J,t(e)),o(e,"singleModeBtn",I,t(e)),e.editBox=void 0,e.gameManager=void 0,e}i(e,n);var a=e.prototype;return a.start=function(){},a.onLoad=function(){this.quicklyJoinBtn.on(s.EventType.CLICK,this.onQuicklyJoinBtnClick,this),this.findJoinBtn.on(s.EventType.CLICK,this.onFindJoinBtnClick,this),this.singleModeBtn.on(s.EventType.CLICK,this.onSingleModeBtnClick,this),this.editBox=this.inputRoomIdTxt.getComponent(c),this.gameManager=new g,this.gameManager.onJoinCallback(this.onJoinCB,this)},a.update=function(n){},a.onQuicklyJoinBtnClick=function(){console.log("onQuicklyJoinBtnClick"),this.gameManager.setIsSinglePlayerMode(!1);var n={userId:Math.floor(1e4*Math.random())};this.gameManager.join(n)},a.onFindJoinBtnClick=function(){console.log("onFindJoinBtnClick"),this.gameManager.setIsSinglePlayerMode(!1);var n={roomId:Number(this.editBox.string),userId:Math.floor(1e4*Math.random())};this.gameManager.findRoom(n)},a.onSingleModeBtnClick=function(){console.log("onSingleModeBtnClick"),this.gameManager.setIsSinglePlayerMode(!0);var n={userId:Math.floor(1e4*Math.random())};this.gameManager.enterJoinSingle(n)},a.onJoinCB=function(){console.log("onJoinCB");var n=this.gameRoom.getComponent(m);n.init(this.gameManager),this.gameRoom.active=!0,n.enterRoom(),this.node.active=!1},e}(u)).prototype,"gameRoom",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=e(b.prototype,"quicklyJoinBtn",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=e(b.prototype,"findJoinBtn",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=e(b.prototype,"inputRoomIdTxt",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=e(b.prototype,"singleModeBtn",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=b))||B));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./env.ts","./migrate-canvas.ts","./Boss.ts","./Enemies.ts","./Enemy.ts","./EnemyBullet.ts","./Flight.ts","./Game.ts","./HpBarSystem.ts","./Joystick.ts","./Lobby.ts","./Maps.ts","./Player.ts","./PlayerBullet.ts","./GameManager.ts","./MathUtil.ts","./TweenPool.ts","./GameSystem.ts","./gameConfig.ts","./ArrowState.ts","./BossState.ts","./EnemyState.ts","./PlayerState.ts","./PtlAddGameRecord.ts","./PtlFindRoom.ts","./PtlGameStart.ts","./PtlGetGameRecord.ts","./PtlJoin.ts","./PtlUpdateGameRecord.ts","./MsgClientInput.ts","./GameRecord.ts","./MsgFrame.ts","./serviceProto.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Maps.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,o,r,s;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,r=n.Vec3,s=n.Component}],execute:function(){var c;e._RF.push({},"d4337jnudxIi7Rc7VzwqqtJ","Maps",void 0);var i=o.ccclass;o.property,n("Maps",i("Maps")(c=function(n){function e(){for(var t,e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];return(t=n.call.apply(n,[this].concat(o))||this).ySpeed=1,t.pos0=new r(0,0,0),t.pos1=new r(0,1334,0),t}t(e,n);var o=e.prototype;return o.onEnable=function(){this.node.children[0].setPosition(this.pos0)},o.start=function(){},e}(s))||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/MathUtil.ts",["cc"],(function(t){var n;return{setters:[function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"e6cc3JUKYtCeYsaq42kjaDD","MathUtil",void 0);t("MathUtil",function(){function t(){}return t.limit=function(t,n,c){return Math.min(c,Math.max(n,t))},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/migrate-canvas.ts",["cc"],(function(){var n,e,t,i,r,o,a;return{setters:[function(c){n=c.cclegacy,e=c.director,t=c.Director,i=c.Canvas,r=c.Camera,o=c.game,a=c.Node}],execute:function(){n._RF.push({},"3f141c+VKdCPZwiDv5aHGNP","migrate-canvas",void 0);var c=1048575;function l(n,e){for(var t=0,i=n.children.length;t<i;t++)n.children[t].layer=e,l(n.children[t],e)}e.on(t.EVENT_AFTER_SCENE_LAUNCH,(function(){var n,t,a,s=null==(n=e.getScene())?void 0:n.children,m=null==(t=e.getScene())?void 0:t.getComponentsInChildren(i);if(!(m.length<=1)){m=m.filter((function(n){return!!n.cameraComponent}));var v=null==(a=e.getScene())?void 0:a.getComponentsInChildren(r),p=0;v.forEach((function(n){return p|=n.visibility&c}));for(var u=[],f=0,C=s.length;f<C;f++){var h=s[f];if(o.isPersistRootNode(h)){var d=h.getComponentsInChildren(i);0!==d.length&&u.push.apply(u,d.filter((function(n){return!!n.cameraComponent})))}}u.forEach((function(n){if(m.find((function(e){return e!==n&&e.cameraComponent.visibility&n.cameraComponent.visibility&c}))){var e=~p,t=e&~(e-1);n.cameraComponent.visibility=t|4293918720&n.cameraComponent.visibility,l(n.node,t),p|=e}}))}}));var s=a.prototype.setParent;function m(n){var e=0,t=n.getComponent(i);return t&&t.cameraComponent?e=t.cameraComponent.visibility&t.node.layer?t.node.layer:t.cameraComponent.visibility&~(t.cameraComponent.visibility-1):(n.parent&&(e=m(n.parent)),e)}a.prototype.setParent=function(n,e){if(s.call(this,n,e),n){var t=m(this);t&&(this.layer=t,l(this,t))}},n._RF.pop()}}}));

System.register("chunks:///_virtual/MsgClientInput.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"6a8e5ubV2tICbLUvih6KCCg","MsgClientInput",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/MsgFrame.ts",["cc"],(function(){var e;return{setters:[function(c){e=c.cclegacy}],execute:function(){e._RF.push({},"a671592akxDUZOMdB1XDDGc","MsgFrame",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerBullet.ts","./Enemy.ts","./Boss.ts","./gameConfig.ts"],(function(t){var e,n,o,l,i,r,a,s,u,c,f,h,g,d,p,C,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,l=t.assertThisInitialized,i=t.createClass},function(t){r=t.cclegacy,a=t._decorator,s=t.Prefab,u=t.instantiate,c=t.Vec3,f=t.Collider2D,h=t.Contact2DType,g=t.Component},function(t){d=t.PlayerBullet},function(t){p=t.Enemy},function(t){C=t.Boss},function(t){y=t.gameConfig}],execute:function(){var _,B,v,b,m;r._RF.push({},"246e8keu/JMRLl8NroJCPr2","Player",void 0);var P=a.ccclass,I=a.property;t("Player",(_=P("Player"),B=I(s),_((m=e((b=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,o(e,"bulletPrefab",m,l(e)),e._target=void 0,e._options=void 0,e._arrowInstances={},e._onFlightBulletCollide=void 0,e}n(e,t);var r=e.prototype;return r.start=function(){},r.onLoad=function(){},r.onEnable=function(){},r.onDisable=function(){},r.onFlightBulletCollideCallback=function(t,e){this._onFlightBulletCollide=t,this._target=e},r.addOneBullet=function(t){var e=this._arrowInstances[t.id];if(!e){var n=u(this.bulletPrefab);this.node.addChild(n),2==t.bulletType&&n.setScale(new c(4,6)),(e=this._arrowInstances[t.id]=n.getComponent(d)).init(t),e.onBulletRemoveCB(this.bulletRemoveCB,this),n.getComponent(f).on(h.BEGIN_CONTACT,this.beginContact,this)}},r.beginContact=function(t,e){var n,o=t.node,l=e.node,i=o.getComponent(d).getId(),r=l.getComponent(p),a=l.getComponent(C),s=-1;if(r)s=r.getId(),null==(n=this._onFlightBulletCollide)||n.call(this._target,i,s,y.CollisionType.FlightBulletAndEnemy);else if(a){var u;s=a.getId(),null==(u=this._onFlightBulletCollide)||u.call(this._target,i,s,y.CollisionType.FlightBulletAndBoss)}},r.removePlayerBullet=function(t){var e=this._arrowInstances[t];e&&e.removePlayerBullet()},r.bulletRemoveCB=function(t){delete this._arrowInstances[t]},i(e,[{key:"options",get:function(){return this._options},set:function(t){this._options=t}},{key:"arrowInstances",get:function(){return this._arrowInstances}}]),e}(g)).prototype,"bulletPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=b))||v));r._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerBullet.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,o,s,n;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,o=t._decorator,s=t.Vec3,n=t.Component}],execute:function(){var r;i._RF.push({},"48c30MQGWVK/ILDMp7Mw3Tp","PlayerBullet",void 0);var l=o.ccclass;o.property,t("PlayerBullet",l("PlayerBullet")(r=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).id=void 0,e.state=void 0,e._onBulletRemoveCB=void 0,e._target=void 0,e._startPos=new s,e._endPos=new s,e.dir=void 0,e.dirX=0,e.dirY=0,e}e(i,t);var o=i.prototype;return o.getId=function(){return this.id},o.onLoad=function(){},o.start=function(){},o.init=function(t){this.id=t.id,this.state=t,this._startPos.set(t.pos.x,t.pos.y),this._endPos.set(t.targetPos.x,t.targetPos.y),this.node.position=this._startPos},o.onBulletRemoveCB=function(t,e){this._onBulletRemoveCB=t,this._target=e},o.update=function(t){this.updatePlayerBulletPos()},o.updatePlayerBulletPos=function(){var t=this._endPos.x-this.node.position.x,e=this._endPos.y-this.node.position.y,i=t*t+e*e;if(i<=1)this.removePlayerBullet();else{if(!this.dir){var o=Math.sqrt(i);this.dirX=t/o,this.dirY=e/o,this.dir={x:this.dirX,y:this.dirY}}var n;n=100>=i?new s(this._endPos.x,this._endPos.y):new s(this.node.position.x+10*this.dirX,this.node.position.y+10*this.dirY),this.node.setPosition(n)}},o.removePlayerBullet=function(){var t;null==(t=this._onBulletRemoveCB)||t.call(this._target,this.getId()),this.node.removeFromParent(),this.node.destroy()},i}(n))||r);i._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerState.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"e60a3gmV/FOiLD+zn4tK/mU","PlayerState",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PtlAddGameRecord.ts",["cc"],(function(){var e;return{setters:[function(c){e=c.cclegacy}],execute:function(){e._RF.push({},"127c9nx5ChEXaVyfIphzmUK","PtlAddGameRecord",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/PtlFindRoom.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"88ed7prmHVJbo6J84MiVAfh","PtlFindRoom",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PtlGameStart.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"f89b87sBflMA5sXJ+aDpE+f","PtlGameStart",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PtlGetGameRecord.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"8a7c1KOoOdOtY5Fcbvbwa+z","PtlGetGameRecord",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/PtlJoin.ts",["cc"],(function(){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"1f497+8B8xKfLuhOXFr5Q3z","PtlJoin",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/PtlUpdateGameRecord.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"cf076oJCpFFh7LZZIo55AJE","PtlUpdateGameRecord",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/serviceProto.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"1f0efqgty1OMrl7dRlmReaF","serviceProto",void 0);e("serviceProto",{version:29,services:[{id:0,name:"client/ClientInput",type:"msg"},{id:3,name:"AddGameRecord",type:"api"},{id:6,name:"FindRoom",type:"api"},{id:7,name:"GameStart",type:"api"},{id:4,name:"GetGameRecord",type:"api"},{id:1,name:"Join",type:"api"},{id:5,name:"UpdateGameRecord",type:"api"},{id:2,name:"server/Frame",type:"msg"}],types:{"client/MsgClientInput/MsgClientInput":{type:"Interface",properties:[{id:0,name:"sn",type:{type:"Number"}},{id:1,name:"inputs",type:{type:"Array",elementType:{type:"Reference",target:"client/MsgClientInput/ClientInput"}}}]},"client/MsgClientInput/ClientInput":{type:"Union",members:[{id:0,type:{target:{type:"Reference",target:"../game/GameSystem/PlayerMove"},keys:["playerId"],type:"Omit"}},{id:1,type:{target:{type:"Reference",target:"../game/GameSystem/PlayerAttack"},keys:["playerId"],type:"Omit"}},{id:2,type:{target:{type:"Reference",target:"../game/GameSystem/BeginContact"},keys:["playerId"],type:"Omit"}}]},"../game/GameSystem/PlayerMove":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerMove"}},{id:1,name:"playerId",type:{type:"Number"}},{id:2,name:"speed",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:4,name:"rollD",type:{type:"String"}},{id:3,name:"dt",type:{type:"Number"}}]},"../game/GameSystem/PlayerAttack":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerAttack"}},{id:4,name:"bulletNum",type:{type:"Number"}},{id:1,name:"playerId",type:{type:"Number"}},{id:5,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:2,name:"targetPos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:3,name:"targetTime",type:{type:"Number"}}]},"../game/GameSystem/BeginContact":{type:"Interface",properties:[{id:5,name:"playerId",type:{type:"Number"}},{id:0,name:"type",type:{type:"Literal",literal:"BeginContact"}},{id:1,name:"contactNum",type:{type:"Number"}},{id:6,name:"id1",type:{type:"Number"}},{id:7,name:"id2",type:{type:"Number"}},{id:4,name:"nowTime",type:{type:"Number"}}]},"PtlAddGameRecord/ReqAddGameRecord":{type:"Interface",properties:[{id:0,name:"newGameRecord",type:{target:{type:"Reference",target:"models/GameRecord/GameRecord"},keys:["roomId","create"],type:"Pick"}}]},"models/GameRecord/GameRecord":{type:"Interface",properties:[{id:0,name:"_id",type:{type:"String"}},{id:1,name:"roomId",type:{type:"String"}},{id:2,name:"score",type:{type:"Number"},optional:!0},{id:3,name:"fellowPlayerId",type:{type:"Number"},optional:!0},{id:4,name:"create",type:{type:"Interface",properties:[{id:0,name:"playerId",type:{type:"Number"}},{id:1,name:"time",type:{type:"Date"}}]}},{id:5,name:"end",type:{type:"Interface",properties:[{id:0,name:"time",type:{type:"Date"}}]},optional:!0}]},"PtlAddGameRecord/ResAddGameRecord":{type:"Interface",properties:[{id:0,name:"insertedId",type:{type:"String"}}]},"PtlFindRoom/ReqFindRoom":{type:"Interface",properties:[{id:0,name:"roomId",type:{type:"Number"}},{id:1,name:"userId",type:{type:"Number"}}]},"PtlFindRoom/ResFindRoom":{type:"Interface",properties:[{id:0,name:"roomId",type:{type:"Number"}},{id:1,name:"gameState",type:{type:"Reference",target:"../game/GameSystem/GameSystemState"}}]},"../game/GameSystem/GameSystemState":{type:"Interface",properties:[{id:0,name:"now",type:{type:"Number"}},{id:5,name:"gameState",type:{type:"Number"}},{id:1,name:"players",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/PlayerState/PlayerState"}}},{id:6,name:"bosses",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/BossState/BossState"}}},{id:7,name:"bossBullets",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/ArrowState/ArrowState"}}},{id:8,name:"nextBossBulletId",type:{type:"Number"}},{id:4,name:"enemys",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/EnemyState/EnemyState"}}},{id:2,name:"arrows",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/ArrowState/ArrowState"}}},{id:3,name:"nextArrowId",type:{type:"Number"}}]},"../game/state/PlayerState/PlayerState":{type:"Interface",properties:[{id:0,name:"id",type:{type:"Number"}},{id:9,name:"planeId",type:{type:"Number"}},{id:1,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:6,name:"rollD",type:{type:"String"}},{id:2,name:"dizzyEndTime",type:{type:"Number"},optional:!0},{id:5,name:"score",type:{type:"Number"}},{id:7,name:"mainBulletNum",type:{type:"Number"}},{id:8,name:"mainBulletInterval",type:{type:"Number"}},{id:10,name:"hp",type:{type:"Number"}},{id:13,name:"maxHp",type:{type:"Number"}},{id:12,name:"damage",type:{type:"Number"}},{id:11,name:"deadFlg",type:{type:"Boolean"}}]},"../game/state/BossState/BossState":{type:"Interface",properties:[{id:0,name:"id",type:{type:"Number"}},{id:1,name:"monsterId",type:{type:"Number"}},{id:2,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:5,name:"currStage",type:{type:"Number"}},{id:6,name:"stage1",type:{type:"Interface",properties:[{id:0,name:"targetX",type:{type:"Number"}},{id:1,name:"targetY",type:{type:"Number"}},{id:2,name:"moveTime",type:{type:"Number"}},{id:3,name:"stayTime",type:{type:"Number"}},{id:4,name:"stayStartTime",type:{type:"Number"}},{id:5,name:"dir",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]},optional:!0}]}},{id:7,name:"stage2",type:{type:"Interface",properties:[{id:0,name:"targetX",type:{type:"Number"}},{id:1,name:"targetY",type:{type:"Number"}},{id:2,name:"moveTime",type:{type:"Number"}},{id:3,name:"stayTime",type:{type:"Number"}},{id:4,name:"stayStartTime",type:{type:"Number"}},{id:5,name:"dir",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]},optional:!0}]}},{id:8,name:"stage3",type:{type:"Interface",properties:[{id:0,name:"targetX",type:{type:"Number"}},{id:1,name:"targetY",type:{type:"Number"}},{id:2,name:"moveTime",type:{type:"Number"}},{id:3,name:"stayTime",type:{type:"Number"}},{id:4,name:"stayStartTime",type:{type:"Number"}},{id:5,name:"dir",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]},optional:!0}]}},{id:9,name:"stage4",type:{type:"Interface",properties:[{id:0,name:"targetX",type:{type:"Number"}},{id:1,name:"targetY",type:{type:"Number"}},{id:2,name:"moveTime",type:{type:"Number"}},{id:3,name:"stayTime",type:{type:"Number"}},{id:4,name:"stayStartTime",type:{type:"Number"}},{id:5,name:"dir",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]},optional:!0}]}},{id:11,name:"attackInterval",type:{type:"Number"}},{id:12,name:"lastAttackTime",type:{type:"Number"}},{id:3,name:"hp",type:{type:"Number"}},{id:13,name:"maxHp",type:{type:"Number"}},{id:4,name:"damage",type:{type:"Number"}},{id:10,name:"deadFlg",type:{type:"Boolean"}}]},"../game/state/ArrowState/ArrowState":{type:"Interface",properties:[{id:0,name:"id",type:{type:"Number"}},{id:4,name:"bulletType",type:{type:"Number"}},{id:1,name:"fromPlayerId",type:{type:"Number"}},{id:2,name:"targetTime",type:{type:"Number"}},{id:5,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:3,name:"targetPos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}}]},"../game/state/EnemyState/EnemyState":{type:"Interface",properties:[{id:0,name:"id",type:{type:"Number"}},{id:1,name:"planeType",type:{type:"Number"}},{id:5,name:"speed",type:{type:"Number"}},{id:3,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:6,name:"dir",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]},optional:!0},{id:8,name:"moveDuration",type:{type:"Number"},optional:!0},{id:4,name:"targetPos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:7,name:"isUpgradeEnemy",type:{type:"Boolean"}}]},"PtlGameStart/ReqGameStart":{type:"Interface",properties:[{id:0,name:"roomId",type:{type:"Number"}},{id:1,name:"userId",type:{type:"Number"}}]},"PtlGameStart/ResGameStart":{type:"Interface",properties:[{id:0,name:"roomId",type:{type:"Number"}},{id:1,name:"gameState",type:{type:"Reference",target:"../game/GameSystem/GameSystemState"}}]},"PtlGetGameRecord/ReqGetGameRecord":{type:"Interface",properties:[{id:0,name:"_id",type:{type:"String"}}]},"PtlGetGameRecord/ResGetGameRecord":{type:"Interface",properties:[{id:0,name:"gameRecord",type:{type:"Reference",target:"models/GameRecord/GameRecord"}}]},"PtlJoin/ReqJoin":{type:"Interface",properties:[{id:1,name:"userId",type:{type:"Number"}}]},"PtlJoin/ResJoin":{type:"Interface",properties:[{id:2,name:"roomId",type:{type:"Number"}},{id:1,name:"gameState",type:{type:"Reference",target:"../game/GameSystem/GameSystemState"}}]},"PtlUpdateGameRecord/ReqUpdateGameRecord":{type:"Interface",properties:[{id:0,name:"update",type:{type:"Intersection",members:[{id:0,type:{type:"Partial",target:{target:{type:"Reference",target:"models/GameRecord/GameRecord"},keys:["score","fellowPlayerId"],type:"Pick"}}},{id:1,type:{type:"Interface",properties:[{id:0,name:"_id",type:{type:"String"}}]}}]}}]},"PtlUpdateGameRecord/ResUpdateGameRecord":{type:"Interface",properties:[{id:0,name:"matchedNum",type:{type:"Number"}}]},"server/MsgFrame/MsgFrame":{type:"Interface",properties:[{id:0,name:"inputs",type:{type:"Array",elementType:{type:"Reference",target:"../game/GameSystem/GameSystemInput"}}},{id:1,name:"lastSn",type:{type:"Number"},optional:!0},{id:2,name:"msgEnd",type:{type:"Boolean"}}]},"../game/GameSystem/GameSystemInput":{type:"Union",members:[{id:0,type:{type:"Reference",target:"../game/GameSystem/PlayerMove"}},{id:1,type:{type:"Reference",target:"../game/GameSystem/PlayerAttack"}},{id:6,type:{type:"Reference",target:"../game/GameSystem/BeginContact"}},{id:2,type:{type:"Reference",target:"../game/GameSystem/PlayerJoin"}},{id:8,type:{type:"Reference",target:"../game/GameSystem/GameStart"}},{id:9,type:{type:"Reference",target:"../game/GameSystem/BossJoin"}},{id:5,type:{type:"Reference",target:"../game/GameSystem/EnemyEnemyJoin"}},{id:3,type:{type:"Reference",target:"../game/GameSystem/PlayerLeave"}},{id:4,type:{type:"Reference",target:"../game/GameSystem/TimePast"}},{id:7,type:{type:"Reference",target:"../game/GameSystem/GameOver"}}]},"../game/GameSystem/PlayerJoin":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerJoin"}},{id:1,name:"playerId",type:{type:"Number"}},{id:6,name:"planeId",type:{type:"Number"}},{id:2,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:3,name:"score",type:{type:"Number"}},{id:4,name:"mainBulletNum",type:{type:"Number"}},{id:5,name:"mainBulletInterval",type:{type:"Number"}}]},"../game/GameSystem/GameStart":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"GameStart"}},{id:1,name:"modelType",type:{type:"Number"}},{id:2,name:"playerId",type:{type:"Number"}}]},"../game/GameSystem/BossJoin":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"BossJoin"}},{id:1,name:"bossId",type:{type:"Number"}},{id:2,name:"monsterId",type:{type:"Number"}}]},"../game/GameSystem/EnemyEnemyJoin":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"EnemyEnemyJoin"}},{id:1,name:"planeType",type:{type:"Number"}},{id:2,name:"playerId",type:{type:"Number"}},{id:6,name:"speed",type:{type:"Number"}},{id:4,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:5,name:"targetPos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:7,name:"isUpgradeEnemy",type:{type:"Boolean"}}]},"../game/GameSystem/PlayerLeave":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerLeave"}},{id:1,name:"playerId",type:{type:"Number"}}]},"../game/GameSystem/TimePast":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"TimePast"}},{id:1,name:"dt",type:{type:"Number"}}]},"../game/GameSystem/GameOver":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"GameOver"}},{id:1,name:"winnerPlayerId",type:{type:"Number"}},{id:2,name:"maxScore",type:{type:"Number"}}]}}});t._RF.pop()}}}));

System.register("chunks:///_virtual/TweenPool.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"0e776cfwcVLJJgt0LvArxQ3","TweenPool",void 0);t("TweenPool",function(){function t(){this._tweens=[]}var e=t.prototype;return e.add=function(t){this._tweens.push(t)},e.clear=function(){var t;null==(t=this._tweens)||t.forEach((function(t){return t.stop()})),this._tweens=[]},t}());e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});